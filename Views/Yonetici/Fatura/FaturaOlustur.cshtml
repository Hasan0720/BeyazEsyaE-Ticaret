@model BeyazEsyaE_Ticaret.Models.FaturaOlusturViewModel

@{
    ViewBag.Title = "Fatura Oluştur";
    Layout = "~/Views/Shared/_YoneticiLayout.cshtml";
}

<div class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center mb-4 gap-2">
    <h3><i class="fas fa-edit text-success me-2"></i>Fatura Oluştur</h3>
    <a href="@Url.Action("Index", "Fatura")" class="btn btn-sm btn-outline-secondary">
        <i class="fas fa-arrow-left"></i> Fatura Listesine Dön
    </a>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card shadow-sm">
            <div class="card-header bg-light fw-bold">
                <i class="fas fa-file-invoice text-dark"></i> Fatura Bilgileri
            </div>

            <!-- Fatura oluşturma formu-->
            <div class="card-body">
                <form method="post" action="@Url.Action("FaturaOlustur", "Fatura")">
                    @Html.AntiForgeryToken()
                    @Html.Hidden("siparisID", Model.SiparisID)

                    <div class="form-group mb-3">
                        <label class="form-label fw-bold">Sipariş No</label>
                        <input type="text" class="form-control" value="@Model.SiparisID" readonly />
                    </div>

                    <div class="form-group mb-3">
                        <label class="form-label fw-bold">Sipariş Tarihi</label>
                        <input type="text" class="form-control" value="@Model.SiparisTarihi.ToShortDateString()" readonly />
                    </div>

                    <div class="form-group mb-3">
                        <label class="form-label fw-bold">Teslimat Adresi</label>
                        <textarea class="form-control" rows="2" readonly>@Model.TeslimatAdresi</textarea>
                    </div>

                    <div class="form-group mb-3">
                        <label class="form-label fw-bold">Müşteri Ad Soyad</label>
                        <input type="text" class="form-control" value="@Model.MusteriAdSoyad" readonly />
                    </div>

                    <div class="form-group mb-4">
                        <label class="form-label fw-bold">Siparişe Ait Ürünler</label>
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm">
                                <thead class="table-light">
                                    <tr>
                                        <th>Ürün Adı</th>
                                        <th>Adet</th>
                                        <th>Birim Fiyat</th>
                                        <th>KDV Tutarı</th>
                                        <th>Toplam Fiyat (KDV Dahil)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.Urunler)
                                    {
                                        var kdv = item.ToplamFiyat * 0.20m;
                                        var toplamKdvDahil = item.ToplamFiyat + kdv;

                                        <tr>
                                            <td>@item.UrunAdi</td>
                                            <td>@item.Adet</td>
                                            <td>@item.BirimFiyat.ToString("C")</td>
                                            <td>@kdv.ToString("C")</td>
                                            <td>@toplamKdvDahil.ToString("C")</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="form-group mb-4 text-end">
                        <label class="form-label fw-bold">Toplam Tutar:</label>
                        <h5 class="badge bg-success fs-5">@Model.ToplamTutar.ToString("C")</h5>
                    </div>

                    <div class="d-flex justify-content-end gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-check-circle"></i> Faturayı Oluştur
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bilgilendirme kartı-->
    <div class="col-md-4">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <i class="fas fa-info-circle text-primary me-1"></i> Bilgilendirme
            </div>
            <div class="card-body">
                <p class="card-text">
                    Bu sayfa, siparişe ait bilgileri görüntüleyerek fatura oluşturmanızı sağlar.
                </p>
                <p class="card-text">
                    Faturalar sistemde kayıt altına alınır ve siparişin durumu "Faturalandı" olarak güncellenir.
                </p>
                <p class="card-text">
                    Sayfadaki bilgiler, siparişe ait sistem verilerinden otomatik olarak çekilmiştir.
                </p>
                <hr />
                <p class="card-text text-muted">
                    Fatura oluşturma işlemi geri alınamaz. Lütfen faturayı oluşturmadan önce bilgileri kontrol edin.
                </p>
            </div>
        </div>
    </div>
</div>
